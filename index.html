<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>語料庫 x 爬蟲</title>
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.7.0/css/theme/night.min.css">
    <link rel="stylesheet" href="plugin/title-footer/title-footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/tomorrow-night-bright.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <style>
    section img {
      border: none !important;
      background: none !important;
      box-shadow: none !important;
    }
    pre {
      box-shadow: none !important;
    }
    .reveal pre code {
      border-radius: 10px;
      opacity: 0.7;
    }
    .line {
      display: block;
    }
    .line.focus {
      background: rgba(255, 255, 0, 0.4);
      border-radius: 3px;
    }
    .fragment.current-visible.visible:not(.current-fragment) {
     display: none;
      height:0px;
      line-height: 0px;
      font-size: 0px;
    }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">

        <section data-markdown>
          <textarea data-template>
# 語料庫 x 爬蟲

<a target="_blank" href="https://aji.tw">
![logo](https://aji.tw/static_all/img/logo.png) <!-- .elements width="60px" -->
</a>

<canvas id="qr"></canvas>
          </textarea>
        </section>

        <section>
          <section data-markdown>
            <textarea data-template>
## 什麼蟲？能吃嗎？
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### 爬蟲是什麼？

> 網路爬蟲...是一種用來自動瀏覽全球資訊網的網路機器人。其目的一般為編纂網路索引。 網路搜尋引擎等站點通過爬蟲軟體更新自身的網站內容或其對其他網站的索引。網路爬蟲可以將自己所存取的頁面儲存下來，以便搜尋引擎事後生成索引供用戶搜尋。 (來源：[維基百科](https://zh.wikipedia.org/zh-tw/網路爬蟲))
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
簡單講就是...

把別人的東西變成自己的東西 <!-- .elements class="fragment" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### 全世界最大的爬蟲公司
![google](https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg) <!-- .elements class="fragment" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
              這些公司也都是
              <div style="background-color:rgba(255, 255, 255, 0.6);border-radius:5px">
![Bing](https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Bing_logo_%282016%29.svg/1000px-Bing_logo_%282016%29.svg.png)  <!-- .elements width="200px" -->
![Yahoo](https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Yahoo%21_logo.svg/512px-Yahoo%21_logo.svg.png) <!-- .elements width="200px" -->
![DuckDuckGo](https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/DuckDuckGo_logo_and_wordmark_%282014-present%29.svg/250px-DuckDuckGo_logo_and_wordmark_%282014-present%29.svg.png) <!-- .elements width="200px" -->
![Baiduspider](https://upload.wikimedia.org/wikipedia/en/thumb/f/f4/Baidu.svg/231px-Baidu.svg.png) <!-- .elements width="200px" -->
![Sogou](https://upload.wikimedia.org/wikipedia/en/3/38/Sogou_logo.png) <!-- .elements width="200px" -->
![Facebook](https://upload.wikimedia.org/wikipedia/commons/c/cd/Facebook_logo_%28square%29.png) <!-- .elements width="50px" -->
![Alexa](https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_Alexa_logo.svg) <!-- .elements width="250px" -->
              </div>
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### `robots.txt` 

> robots.txt 是一種存放於網站根目錄下的文字檔案，它通常告訴網路搜尋引擎此網站中的哪些內容是不應被搜尋引擎取得的，哪些是可以被取得的。[(wiki)](https://zh.wikipedia.org/zh-tw/Robots.txt)

<i class="fas fa-bullhorn"></i> 
不是規範，只是約定俗成
            </textarea>
          </section>
        </section>

        <section>
          <section data-markdown>
            <textarea data-template>
## 爬蟲攻防戰 
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### 反爬蟲

+ IP 黑名單 
    - （無限）轉址
    - 404 Not Found
    - 503 Service Unavailable
    - 504 Gateway Timeout
+ 程式碼混淆 
+ javascript 偵測 
+ 文字圖形化 
+ 圖形驗證碼 
+ No CAPTCHA reCAPTCHA 
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### 反反爬蟲

| 道高一尺               |     魔高一丈              |
| ---------------------- | ------------------------- |
| IP 黑名單              | 代理伺服器 手機網路       |
| 程式碼混淆             |  逆向工程                 | 
| javascript 偵測        | 模擬 javascript           |
| 文字圖形化             | 光學字元辨識              |
| 圖形驗證碼             | 人工智慧                  | 
| No CAPTCHA reCAPTCHA   | 工人智慧                  |
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### 反反反爬蟲

+ 反反反反爬蟲 <!-- .elements class="fragment"> -->
+ 反反反反反爬蟲 <!-- .elements class="fragment"> -->
+ 反反反反反反爬蟲 <!-- .elements class="fragment"> -->
+ 反反反反反反反爬蟲 <!-- .elements class="fragment"> -->
+ 反反反反反反反反爬蟲 <!-- .elements class="fragment"> -->
+ 反反反反反反反反反爬蟲 <!-- .elements class="fragment"> -->
+ 反反反反反反反反反反爬蟲 <!-- .elements class="fragment"> -->
            </textarea>
          </section>
        </section>

        <section> 
          <section data-markdown>
            <textarea data-template>
## 工欲善其事 
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### <i class="fab fa-python"></i> Python

+ 發行版 - [官方版本](https://www.python.org) 
+ 版本 - `3.6+`
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
###  瀏覽器 

<i class="fab fa-chrome"></i> Google Chrome

            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### PIP 套件

+ [`requests`](http://docs.python-requests.org/en/master/)
+ [`BeautifulSoup`](https://www.crummy.com/software/BeautifulSoup/bs4/doc/)

安裝
```bash
pip install -U requests
pip install -U beautifulsoup4
```
            </textarea>
          </section>
        </section>

        <section>
          <section data-markdown>
            <textarea data-template>
## 基礎知識 
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
請先準備一個測試用的 web server  
<i class="fas fa-code"></i> 建立 `server.py`
```python
from http.server import SimpleHTTPRequestHandler
from socketserver import TCPServer

class WebServer(SimpleHTTPRequestHandler):

    def do_GET(self):
        print(self.headers)
        super().do_GET()

print('press CTRL+C to stop...')
TCPServer(("127.0.0.1", 8000), WebServer).serve_forever()
```

<i class="fas fa-code"></i> 在終端機執行

```bash
python server.py
```
            </textarea>
          </section>
          <section data-markdown class="extra_layer">
            <textarea data-template>
### 網頁技術 

|        |                           |
| ------ | ------------------------- |
| HTML   | HyperText Markup Language |
| DOM    | Dom Object Model          |
| CSS    | Cascading Style Sheets    |
| JS     | javascript                |
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### HTTP 標頭 (headers) 

```text
Accept: text/html,application/xhtml+xm…plication/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.5
Connection: keep-alive
Cookie: __cfduid=df5348086ef38be7990d6…d=GA1.2.1406394816.1522116242
Host: static.tutsplus.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linu…) Gecko/20100101 Firefox/59.0
```
User-Agent 代表的是瀏覽器的資訊 <!-- .elements class="fragment" data-code-focus="7" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
<i class="fas fa-code"></i> 查看 `User-Agent` 

```python 
from requests import Session

session = Session()
print(session.headers['user-agent'])
session.get('http://127.0.0.1:8000')
```

預設為 python-requests/2.19.1 <!-- .element: class="fragment current-visible" data-code-focus="4" -->

發送請求至 web server，看到一樣的 User-Agent <!-- .element: class="fragment current-visible" data-code-focus="5" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
<i class="fas fa-code"></i> 更改 `User-Agent` 

```python 
google_ua = 'Googlebot/2.1 (+http://www.google.com/bot.html)'
session.headers['User-Agent'] = google_ua
session.get('http://127.0.0.1:8000')
```
這是 Google 常用的 User-Agent <!-- .element: class="fragment current-visible" data-code-focus="1" -->

修改預設 User-Agent <!-- .element: class="fragment current-visible" data-code-focus="2" -->

從 web server 查看是否成功 <!-- .element: class="fragment current-visible" data-code-focus="3" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### [HTTP 請求方法](https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Methods)

+ GET <!-- .element: class="fragment highlight-red grow" -->
+ POST <!-- .element: class="fragment highlight-red grow" -->
+ HEAD 
+ PUT
+ DELETE
+ CONNECT
+ OPTIONS
+ TRACE
+ PATCH
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
<i class="fas fa-code"></i> 發送請求 
```python 
session.get('http://127.0.0.1')
session.post('http://127.0.0.1')
```
這就是一個 GET 的請求 <!-- .element: class="fragment current-visible" data-code-focus="1" -->

這就是一個 POST 的請求 <!-- .element: class="fragment current-visible" data-code-focus="2" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### [HTTP 狀態碼](https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Status)
+ `1xx` 資訊回應
+ `2xx` 成功為應
+ `3xx` 重定向訊息
+ `4xx` 用戶端錯誤回應
+ `5xx` 伺服器端錯誤回應
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
<i class="fas fa-code"></i> 查看狀態碼

`GET`
```python 
response = session.get('http://127.0.0.1')
print(response.status_code)
```

`POST`
```python
response = session.post('http://127.0.0.1')
print(response.status_code)
```
得到 200，代表成功回應 <!-- .element: class="fragment current-visible" data-code-focus="2" -->

得到 501，代表伺服器沒有實作這個請求方法 <!-- .element: class="fragment current-visible" data-code-focus="4" -->
            </textarea>
          </section>
          <section data-markdown>
            <textarea data-template>
### 網頁元素定位 

| CSS 選擇器     | 意義                                 
| -------------  |----------------------
| `*         `   | 任一元素
| `p         `   | `p` 標籤 (tag)
| `p > *     `   | `p` 下一階的任一元素
| `#foo      `   | `id="foo"` 
| `.foo      `   | `class="foo"` 
            </textarea>
          </section>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script type="text/javascript">
    (function(){
        var tId = setInterval(function() {
          if (document.readyState == "complete") onComplete()
        }, 11);
        function onComplete(){
          clearInterval(tId);    
          var qr = new QRious({
            element: document.getElementById('qr'),
            value: window.location.href,
            size: 180,
          });
        };
    })()
    </script>
    <script>
      Reveal.initialize({
        history: true,
        slideNumber: true,
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'https://cdn.jsdelivr.net/npm/reveal-code-focus@1.0.0/reveal-code-focus.min.js', async: true, callback: function() { RevealCodeFocus() } },
          { src: 'plugin/reveal.js-menu/menu.js'},
          { src: 'https://cdn.rawgit.com/e-gor/Reveal.js-Title-Footer/master/plugin/title-footer/title-footer.js', async: true, callback: function() { title_footer.initialize(); } }
        ],
        parallaxBackgroundImage: './img/red-purple-abstract-w1.jpg',
        parallaxBackgroundSize: '2500px',
        parallaxBackgroundHorizontal: 90,
        parallaxBackgroundVertical: 50,
        menu: {
          hideMissingTitles: true,
          numbers: true,
          markers: true,
          themes: false,
          transitions: false
        }
      });
    </script>
    <script>
      document.querySelectorAll('section > h1, section > h2, section > h3').forEach(function(e) {
        if (!e.parentElement.getAttribute('id')) {
          var slug = e.innerText.toLowerCase().replace(/[_\s-]/g, '-').replace(/[+().]/g, '').replace('--', '-');
          e.parentElement.setAttribute('id', slug);
        }
      });
      Reveal.addEventListener('slidechanged', function(event) {
        if (event.currentSlide.getAttribute('data-background-iframe')) {
          document.querySelector('.reveal > .backgrounds').style['z-index'] = 1;
          console.log('z-index set to 1');
        } else {
          document.querySelector('.reveal > .backgrounds').style['z-index'] = 0;
          console.log('z-index set to 0');
        }
      });
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-91846715-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
