<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>語料庫 x 爬蟲</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css">

    <link rel="stylesheet" href="plugin/title-footer/title-footer.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/tomorrow-night-bright.min.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <style>
    section.extra_layer {
      background: rgba(0, 0, 0, 0.8) !important;
    }
    section img {
      border: none !important;
      background: none !important;
      box-shadow: none !important;
    }
    pre {
      box-shadow: none !important;
    }
    .tags {
      list-style: none;
      margin: 0;
      overflow: hidden;
      padding: 0;
    }

    .tags li {
      font-size: 24px;
      font-family: monospace;
      background: #333333;
      border-radius: 8px;
      color: #fff;
      display: inline-block;
      height: 40px !important;
      line-height: 30px !important;
      padding: 10px 10px 0 10px !important;
      /*position: relative;*/
      opacity: 0.7 !important;
      margin: 0 10px 10px 0 !important;
    }
    .yellow {
      color: yellow !important;
    }
    .reveal pre code {
      border-radius: 10px;
      opacity: 0.7;
    }
    footer:first {
      background: red !important;
    }
    .comp-table {
      font-size: 26px !important;
    }
    .comp-table table td:nth-of-type(2),
    .comp-table table td:nth-of-type(3) {
      text-align: center !important;
    }
    #aji {
      position: absolute !important;
      top: 100px !important;
      left: 40%;
      transform: rotateX(60deg) rotateY(348deg) rotateZ(-13deg) !important;
      color: #ffffff !important;
    }
    #aji a {
      font-size: 80px !important;
      color: yellow !important;
      font-weight: bold !important;
    }
    .reveal .slides section .fragment.highlight-current-green.current-fragment {
      background-color: #17ff2e;
      color: #000000;
      opacity: 0.9;
    }
    #dom-parsers + table {
      font-size: 20px;
    }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h2>語料庫 x 爬蟲</h2>
          <p>
            <small>
              Presented by <a href="https://aji.tw">劉純睿</a>
              a.k.a
              <a href="https://aji.tw">阿吉</a>
            </small>
          </p>
        </section>
        <section data-background="img/me.jpg">
          <h2 style="display:none">Aboutn Me</h2>
          <p id="aji" class="fragment">
            <a href="https://aji.tw" target="_blank">aji.tw</a>
          </p>
        </section>
        <section>
          <section>
            <h2>Biggest web crawler company</h2>
            <p class="fragment">
              <a href="https://github.com/gawel/pyquery" target="_blank">
                <img
                  src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg"
                  height="200px"
                />
              </a>
            </p>
          </section>
          <section>
            <h2>What is a Web Crawler?</h2>
            <blockquote class="fragment">
              "Crawler" is a generic term for any program (such as a robot or spider) used to automatically discover and scan websites by following links from one webpage to another. <a href="https://support.google.com/webmasters/answer/1061943?hl=en" target="_blank">(reference)</a>
            </blockquote>
          </section>
          <section data-markdown>
            <script type="text/template">
            ## What does a Crawler do?
            + <span class="fragment highlight-green">E</span>xtract
            + <span class="fragment highlight-green">T</span>ransform
            + <span class="fragment highlight-green">L</span>oad
            </script>
          </section>
          <section data-markdown>
            ## Legal Issues
          </section>
          <section data-markdown>
            ### `robots.txt`
            > A robots.txt file is a file at the root of your site that indicates those parts of your site you don’t want accessed by search engine crawlers [(reference)](https://support.google.com/webmasters/answer/6062608?hl=en)
          </section>
          <section data-background="https://media.giphy.com/media/26tOZlKO9QxXcHPEY/giphy.gif">
          </section>

        </section>
        <section>
          <section data-markdown>
            ## Programming Language
          </section>
          <section class="extra_layer">
            <img
              src="https://cdn.sstatic.net/Sites/stackoverflow/company/img/logos/so/so-logo.svg?v=91934fae83c2"
              height="150px"

            />
            <p>
              <a
                href="https://stackoverflow.com/questions/977597"
                target="_blank">
                What is the ideal program language for a web-crawler?
              </a>
            </p>
            <p>
              <a
                href="https://stackoverflow.com/questions/22168883"
                target="_blank">
                What's the best way of scraping data from a website?
              </a>
            </p>
          </section>
          <section>
            <img
              src="https://legacy.python.org/community/logos/python-logo-generic.svg"
              height="200px"
            />
          </section>
        </section>
        <section>
          <section>
            <h2>Crawler Frameworks</h2>
          </section>
          <section data-markdown class="extra_layer">
            ### Some great Python frameworks
            + [Scrapy](https://github.com/scrapy/scrapy)
            + [Selenium](https://github.com/SeleniumHQ/selenium/tree/master/py)
            + [Mechanize](https://github.com/python-mechanize/mechanize)
            + [RoboBrowser](https://github.com/jmcarp/robobrowser)
            + [Grab](https://github.com/lorien/grab)
            + [Frontera](https://github.com/scrapinghub/frontera)
          </section>
        </section>
        <section>
          <section data-markdown>
            ## The Basics
          </section>
          <section data-markdown class="extra_layer">
            <script type="text/template">
            ### Prerequisites
            + HTML
            <span class="fragment">(HyperText Markup Language)</span>
            + DOM
            <span class="fragment">(Document Object Model)</span>
            + CSS
            <span class="fragment">(Cascading Style Sheets)</span>
            + JS
            <span class="fragment">(JavaScript)</span>
            </script>
          </section>
          <section data-markdown>
            ### HTTP Headers
            ```
Accept: text/html,application/xhtml+xm…plication/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.5
Connection: keep-alive
Cookie: __cfduid=df5348086ef38be7990d6…d=GA1.2.1406394816.1522116242
Host: static.tutsplus.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linu…) Gecko/20100101 Firefox/59.0
            ```
          </section>
          <section data-markdown>
            <script type="text/template">
            ### HTTP Request Methods
            + GET <!-- .element: class="fragment highlight-red" -->
            + HEAD 
            + POST <!-- .element: class="fragment highlight-red" -->
            + PUT
            + DELETE
            + CONNECT
            + OPTIONS
            + TRACE
            + PATCH
            </script>
          </section>
          <section data-markdown>
            ## HTTP Status Code
            + `1xx` Informational responses
            + `2xx` Success
            + `3xx` Redirection
            + `4xx` Client errors
            + `5xx` Server errors
          </section>
          <section data-markdown>
            ## Data Fromat
            + HTML
            + XML
            + JSON
          </section>
          <section data-markdown>
            ### Session vs Cookie
          </section>
          <section data-markdown>
            ### IFrame
          </section>
          <section data-markdown>
            ### AJAX 
          </section>
          <section data-markdown>
            ### Browser Consoles
            ![chrome](https://raw.githubusercontent.com/alrra/browser-logos/master/src/chrome/chrome_256x256.png)
            ![firefox](https://raw.githubusercontent.com/alrra/browser-logos/master/src/firefox/firefox_256x256.png)
            ![safari](https://raw.githubusercontent.com/alrra/browser-logos/master/src/safari/safari_256x256.png)
          </section>
        </section>
        <section>
          <section data-markdown>
            ## Manipulating DOM
          </section> 
          <section class="extra_layer" data-markdown>
            ### DOM Parsers

| XPath | CSS Selector |
|------------------------------------|-------------------|
| //* | * |
| //p | p |
| //p/* | p > * |
| //*[@id=’foo’] | #foo |
| //*[contains(@class,’foo’)] |.foo` |  |
| //*[@title] | *[title] |
| //p/*[0] | p > *:first-child |
| //p[a] | Not possible |
| //p/following-sibling::*[0] | p + * |

          </section>
          <section class="extra_layer" data-markdown>
            ### Python Libraries
            + [PyQuery](https://pyquery.readthedocs.io/en/latest/)
            + [BeautifulSoup4](https://www.crummy.com/software/BeautifulSoup/bs4/doc/)
            + [lxml](http://lxml.de/)
            + [cssselect](https://cssselect.readthedocs.io/en/latest/)
          </section>
          <section data-markdown>
            ### 比美麗的湯更美麗
            [PyCon Taiwan 2017 slides](https://aji.tw/slides/pycon2017)
          </section>
        </section>
        <section>
          <section data-markdown>
            ## Anti-crawling
          </section>
          <section data-markdown>
            ### (Infinite) redirection
          </section>
          <section data-markdown>
            ### 404 Not Found
          </section>
          <section data-markdown>
            ### 503 Service Unavailable
          </section>
          <section data-markdown>
            ### 504 Gateway Timeout
          </section>
          <section data-markdown>
            ### JS detection
          </section>
        </section>
        <section>
          <section data-markdown>
            ## Anti-anti-crawling
          </section>
          <section
            data-background="https://media.giphy.com/media/zebOFPFcgRdG8/giphy.gif"
            data-markdown
            >
            ## S***, I got banned
          </section>
          <section data-markdown>
            ### HTTP Headers Checking 
          </section>
          <section data-markdown>
            ### Obfuscation
            ```
RKbW=function(){'RKbW';var _R=function(){return '=76'}; return _R();};function AIV(AIV_){function _A(AIV_){function ph(){return getName();}function AIV_(){}return ph();return AIV_}; return _A(AIV_);}DmZP='iew';_IX161 = 'assign';function zoQ(zoQ_){function ti(){return getName();};return ti();return 'zoQ'}function r2oe(){'return r2oe';return 'ad&'}_eloda = 'replace';F59s=function(){'return F59s';return 'p?m';};HP=function(){'return HP';return 'n';};function getName(){var caller=getName.caller;if(caller.name){return caller.name} var str=caller.toString().replace(/[\s]*/g,"");var name=str.match(/^function([^\(]+?)\(/);if(name && name[1]){return name[1];} else {return '';}}uM=function(){'return uM';return '9';};eG9=function(eG9_){'return eG9';return eG9_;};function kp(kp_){function _k(kp_){function o(){return getName();}function kp_(){}return o();return kp_}; return _k(kp_);}vD='1';BN=function(){'BN';var _B=function(){return 'r'}; return _B();};HALw='rum';_RZnE9 = 'href';o5y=function(o5y_){'return o5y';return o5y_;};function PH(){'return PH';return '.'}_BDkwZ = location;function w2(){'return w2';return '_'}KTI4=function(){'return KTI4';return '910';};_NUuAJ = window;wX=function(){'wX';var _w=function(){return 'd'}; return _w();};iyL=function(iyL_){'return iyL';return iyL_;};location.replace((function(){'return Q8mM';return '/fo'})()+HALw+PH()+AIV('Gs8')+F59s()+kp('nm')+(function(){'return njFH';return (function(){return 'd=v';})();})()+DmZP+eG9('th')+BN()+(function(){'return XD';return 'e'})()+r2oe()+zoQ('yKM')+wX()+RKbW()+'8&'+w2()+o5y('ds')+iyL('ig')+HP()+(function(){'return l26W';return '=6f'})()+uM()+(function(){'return by';return (function(){return '7';})();})()+KTI4()+vD);_NUuAJ['href']=(function(){'return Q8mM';return '/fo'})()+HALw+PH()+AIV('Gs8')+F59s()+kp('nm')+(function(){'return njFH';return (function(){return 'd=v';})();})()+DmZP;
            ```

            Reverse Engineering

            ```
location.href=forum.php?mod=viewthread&tid=768&_dsign=6f979101
            ```
          </section>
          <section data-markdown>
            ### IP Banning
            ![Tor](https://upload.wikimedia.org/wikipedia/commons/1/15/Tor-logo-2011-flat.svg)

            Tor (The Onion Router)
          </section>
          <section data-markdown>
            ### IP Banning (Cont'd)
            TCP Proxy
            + SOCKS
            + HTTP
          </section>
          <section data-markdown>
            <script type="text/template">
            ### IP Banning (Cont'd)
            ![Android Phone](./img/android-2995824_640.png) <!-- .element: height="500px;" -->
            </script>
          </section>
          <section data-markdown>
            ### Captcha
            ![captcha](https://upload.wikimedia.org/wikipedia/commons/b/b6/Modern-captcha.jpg)

            OCR (Optical Character Recognition)
          </section>
          <section data-markdown>
            ### No CAPTCHA reCAPTCHA
            ![reCAPTCHA](https://upload.wikimedia.org/wikipedia/commons/a/ad/RecaptchaLogo.svg)

            Human Computation (工人智慧)
          </section>
        </section>
        <section>
          <section data-markdown>
            ## Live Demo
          </section>
          <section data-markdown>
            ### Example: PTT - Gossiping
            + Requests
            + Selenium
            + RoboBrowser 
          </section>
          <section data-markdown>
            ### Requests 
            
            ```python
            import requests

            url = 'https://www.ptt.cc/bbs/Gossiping/index.html'
            cookies = {'over18': 'yes'}
            response = requests.get(url, cookies=cookies)
            ```
          </section>
          <section data-markdown>
            ### Requests (cont'd)

            ```python
            from requests import Session

            session = Session()
            session.cookies['over18'] = 'yes'
            url = 'https://www.ptt.cc/bbs/Gossiping/index.html'
            response = session.get(url)
            ```
          </section>
          <section data-markdown>
            ### Selenium

            ```python
            from selenium import webdriver

            browser = webdriver.Firefox()
            url = 'https://www.ptt.cc/bbs/Gossiping/index.html'
            browser.get(url)
            element = browser.find_element_by_css_selector('button[name="yes"]')

            element.click()
            ```
          </section>
          <section data-markdown>
            ### RoboBrowser

            ```python
            from robobrowser import RoboBrowser

            browser = RoboBrowser(history=True)
            form = browser.get_form(action='/ask/over18')
            form['from'].value = 'yes'
            browser.submit_form(form)
            ```
          </section>
        </section>
        <section data-markdown>
          ## Final Words
          + API first
          + Caching
          + Throttling 
          + Hiding
          + Testing
          + Monitoring
        </section>
        <section
          data-background="https://media.giphy.com/media/26FPOogenQv5eOZHO/giphy.gif"
          data-background-size="90%"
          data-background-color="black"
        >
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'https://cdn.rawgit.com/denehyg/reveal.js-menu/master/menu.js'},
          { src: 'https://cdn.rawgit.com/e-gor/Reveal.js-Title-Footer/master/plugin/title-footer/title-footer.js', async: true, callback: function() { title_footer.initialize(); } }
        ],
        parallaxBackgroundImage: './img/abstract-dark-red-4k-37.jpg',
        parallaxBackgroundSize: '2500px',
        parallaxBackgroundHorizontal: 150,
        parallaxBackgroundVertical: 50,
        menu: {
          numbers: true,
          markers: true,
          themes: false,
          transitions: false
        }
      });
    </script>
    <script>
      document.querySelectorAll('section > h1, section > h2, section > h3').forEach(function(e) {
        if (!e.parentElement.getAttribute('id')) {
          var slug = e.innerText.toLowerCase().replace(/[_\s-]/g, '-').replace(/[+().]/g, '').replace('--', '-');
          e.parentElement.setAttribute('id', slug);
        }
      });
      Reveal.addEventListener('slidechanged', function(event) {
        if (event.currentSlide.getAttribute('data-background-iframe')) {
          document.querySelector('.reveal > .backgrounds').style['z-index'] = 1;
          console.log('z-index set to 1');
        } else {
          document.querySelector('.reveal > .backgrounds').style['z-index'] = 0;
          console.log('z-index set to 0');
        }
      });
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-91846715-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
